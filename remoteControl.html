<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="pyramid web application">
		
		<title>remoteControl</title>
		
		<style type="text/css">
			input[type=range][orient=vertical] {
				writing-mode: bt-lr; /* IE */
				-webkit-appearance: slider-vertical; /* WebKit */
				width: 8px;
				height: 175px;
				padding: 0 5px;
			}
		</style>
		

	</head>
	<body>
		<h1>remoteControl</h1>
		
		<div>
			<input id="host_input" type="text">
		</div>
		
		<div id="sliders">
		</div>
		
		
		<script type="text/javascript">
			var DEFAULT_HOST = "localhost:9873";

			
			// Socket ----------------------------------------------------------
			
			var socket = null;
			
			function connect() {
				var host = document.getElementById('host_input').value;
				socket = new WebSocket("ws://"+host+"/");
				socket.onopen = function() {
					socket.send(JSON.stringify({action: "subscribe", data: ["None"]}));
				};
				socket.onopen = function() {
					localStorage.host = host;
				};
				socket.onclose = function() {
					console.log("connection lost ", host);
				}
			}

			document.getElementById('host_input').addEventListener('keydown', function(event) {
				if (event.keyCode==13) {
					connect();
				}
			}, true);

			
			// Slider ----------------------------------------------------------
			
			function createSlider(device, type) {
				var slider = document.createElement('input');
				slider.setAttribute('type', 'range');
				slider.setAttribute('orient', 'vertical');
				slider.setAttribute('min', '0');
				slider.setAttribute('max', '255');
				slider.setAttribute('step', '1');
				slider.setAttribute('value', '0');
				slider.setAttribute('data-device', device);
				slider.setAttribute('data-type', type);
				slider.addEventListener('input', function(event){
					socket.send(JSON.stringify({action: "message", data: [{deviceid: 'lights', func: 'lights.set',
						device: device,
						color: type+':HUE,1,1,0'.replace('HUE', event.target.value/255),
					},]}));
				}, true);
				return slider;
			}
			

			// Init ------------------------------------------------------------
			
			window.onload = function() {
				document.getElementById('host_input').value = localStorage.host || DEFAULT_HOST;
				
				document.getElementById('sliders').appendChild(createSlider('all', 'hsv'));
				
				connect();
			}
		</script>
	</body>
</html>
